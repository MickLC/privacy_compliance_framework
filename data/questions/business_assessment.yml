# modules/business_assessment.yml - Business Assessment Module
---
# Business assessment module - collects company profile and operations
---
objects:
  - company: Individual
---
question: "Step 1: Business Information"
subquestion: |
  First, let's gather information about your business operations, data collection practices, and presence.
  
  This information will help determine which privacy laws apply to your organization and what types of documentation you need.
continue button field: show_business_information_intro
---
question: Business Profile  
fields:
  - Company Name: company.name
    required: True
  - Primary Business Activity (NAICS Code): company.naics_code
    required: True
    datatype: combobox
    choices: naics_choices
    help: |
      Start typing to search for your business activity. This determines industry 
      classification and SBA small business size standards.
  - Number of Employees: company.employee_count
    datatype: integer
    required: True
  - Annual Revenue (USD): company.annual_revenue
    datatype: currency
    required: True
  - note: |
      % if company.naics_code:
      **Industry Classification**: ${get_industry_from_naics(get_naics_code_only())}
      % endif
continue button field: business_profile_complete
---
code: |
  def get_industry_from_naics(naics_code):
    """Derive broad industry category from NAICS code"""
    if not naics_code or len(naics_code) < 2:
      return "Other"
    
    # Map NAICS sectors to your original industry categories
    sector = naics_code[:2]
    
    naics_to_industry = {
      # Healthcare
      "62": "Healthcare",  # Health Care and Social Assistance
      
      # Financial Services  
      "52": "Financial Services",  # Finance and Insurance
      
      # Technology
      "51": "Technology",  # Information
      "54": "Technology",  # Professional, Scientific, and Technical Services (partial)
      
      # Retail
      "44": "Retail",  # Retail Trade
      "45": "Retail",  # Retail Trade
      
      # Education
      "61": "Education",  # Educational Services
      
      # Manufacturing
      "31": "Manufacturing",  # Manufacturing
      "32": "Manufacturing",  # Manufacturing  
      "33": "Manufacturing",  # Manufacturing
      
      # Professional Services (catch remaining 54 codes)
      # Will be handled by specific NAICS code check below
    }
    
    # Check sector-level mapping first
    if sector in naics_to_industry:
      return naics_to_industry[sector]
    
    # Handle Professional Services (NAICS 54) more specifically
    if sector == "54":
      # Legal, accounting, consulting, etc.
      if naics_code.startswith(("5411", "5412", "5416")):  # Legal, accounting, consulting
        return "Professional Services"
      else:
        return "Technology"  # Engineering, computer services, etc.
    
    # Default for unmapped sectors
    return "Other"

  # Auto-populate industry based on NAICS selection
  def company_industry():
    if company.naics_code:
      return get_industry_from_naics(get_naics_code_only())
    return "Other"
  
  # Make it available as a computed attribute
  company.industry = company_industry()
---
# Additional questions for healthcare entities
question: Healthcare-Specific Information
subquestion: |
  Since you identified as being in the healthcare sector, we need some additional information to determine if HIPAA applies to your organization.
fields:
  - "Is your organization a covered entity under HIPAA (healthcare provider, health plan, or healthcare clearinghouse)?": is_hipaa_covered_entity
    datatype: yesnowide
  - "Does your organization act as a business associate to HIPAA covered entities?": is_hipaa_business_associate
    datatype: yesnowide
  - "Do you process, store, or transmit Protected Health Information (PHI)?": processes_phi
    datatype: yesnowide
  - note: |
      
continue button field: healthcare_continue
show if:
  variable: company.industry
  is: "Healthcare"
---
# Additional questions for financial entities
question: Financial Services-Specific Information
subquestion: |
  Since you identified as being in the financial services sector, we need some additional information to determine if financial privacy regulations apply to your organization.
fields:
  - "Is your organization a financial institution as defined by the Gramm-Leach-Bliley Act?": is_glba_financial_institution
    datatype: yesnowide
  - "Do you provide financial products or services to consumers?": provides_financial_products
    datatype: yesnowide
  - "Do you collect nonpublic personal information (NPI) from consumers?": collects_npi
    datatype: yesnowide
  - note: |
      
continue button field: financial_continue
show if:
  variable: company.industry
  is: "Financial Services"
---
code: |
  def sba_size_standards():
    """Logic to determine if the business qualifies as a small business under SBA standards"""
    # This would implement the SBA size standards based on NAICS codes and employee counts
    # Simplified version for demonstration purposes
    return company.employee_count < 100
---
